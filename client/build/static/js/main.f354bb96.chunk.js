(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{213:function(e,t,a){e.exports=a(437)},254:function(e,t){},436:function(e,t,a){},437:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),s=a(72),i=a.n(s),c=a(36),o=a(6),l=a(5),u=a(12),p=a(10),m=a(13),d=function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{id:"headnav",className:"container-fluid"},n.a.createElement("nav",{className:"navbar navbar-expand-md"},n.a.createElement("p",{className:"navbar-brand mb-0 h1 text-white"},n.a.createElement("i",{className:"fas fa-rss"})," busr"),n.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNavAltMarkup","aria-controls":"navbarNavAltMarkup","aria-expanded":"false","aria-label":"Toggle navigation"},n.a.createElement("i",{className:"fas fa-bars",style:{color:"#FFFFFF"}})),n.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNavAltMarkup"},n.a.createElement("div",{className:"navbar-nav"},n.a.createElement(c.b,{className:"nav-item nav-link text-white",to:"/",style:{textDecoration:"none",color:"#FFFFFF"}},"Carte"),n.a.createElement(c.b,{className:"nav-item nav-link text-white",to:"/historique",style:{textDecoration:"none",color:"#FFFFFF"}},"Historique"),n.a.createElement(c.b,{className:"nav-item nav-link text-white",to:"/livetrips",style:{textDecoration:"none",color:"#FFFFFF"}},"D\xe9parts"))))))},f=function(){return n.a.createElement("div",{className:"container-fluid"},n.a.createElement("nav",{className:"navbar sticky-bottom navbar-light bg-light"},n.a.createElement("span",{className:"navbar-brand"},"\xa9 busr 2019")))},h=a(37),v=function(){return n.a.createElement("div",{className:"container-fluid"},n.a.createElement("div",{className:"jumbotron"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",{className:"display-4"},"Page introuvable..."),n.a.createElement("p",{className:"lead"},"La page recherch\xe9e n'est pas disponible."))))},T=a(31),S=a(7),L=a.n(S),b=a(16),E=a(189),y=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"container-fluid"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"R\xe9seau :"),n.a.createElement("div",{id:"stat"},"STM")),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"API :"),n.a.createElement("div",{id:"stat"},"gtfs-r")),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"Rafra\xeechit \xe0 :"),n.a.createElement("div",{id:"stat"},this.props.lastRefreshSTM.substr(0,8))),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"V\xe9hicules actifs / planifi\xe9s :"),n.a.createElement("div",{id:"stat"},this.props.onlineVehiclesSTM," / ",this.props.plannedVehiclesSTM)),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"Lignes en service :"),n.a.createElement("div",{id:"stat"},this.props.routesSTM))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"R\xe9seau :"),n.a.createElement("div",{id:"stat"},"STL")),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"API :"),n.a.createElement("div",{id:"stat"},"nextbus")),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"Rafra\xeechit \xe0 :"),n.a.createElement("div",{id:"stat"},this.props.lastRefreshSTL.substr(0,8))),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"V\xe9hicules actifs / planifi\xe9s :"),n.a.createElement("div",{id:"stat"},this.props.onlineVehiclesSTL," / ",this.props.plannedVehiclesSTL)),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"Lignes en service :"),n.a.createElement("div",{id:"stat"},this.props.routesSTL))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"R\xe9seau :"),n.a.createElement("div",{id:"stat"},"RTL")),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"API :"),n.a.createElement("div",{id:"stat"},"gtfs-r")),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"Rafra\xeechit \xe0 :"),n.a.createElement("div",{id:"stat"},this.props.lastRefreshRTL.substr(0,8))),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"V\xe9hicules actifs / planifi\xe9s :"),n.a.createElement("div",{id:"stat"},this.props.onlineVehiclesRTL," / ",this.props.plannedVehiclesRTL)),n.a.createElement("div",{className:"col-sm",id:"stat-card"},n.a.createElement("div",{id:"nom-stat"},"Lignes en service :"),n.a.createElement("div",{id:"stat"},this.props.routesRTL)))))}}]),t}(r.Component),g=a(177),w=a.n(g).a.connect("busr-mtl.herokuapp.com",{transports:["websocket"]});function R(e){return j.apply(this,arguments)}function j(){return(j=Object(b.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:w.on("refresh data",function(e){return t(null,e)}),w.emit("subscribeToTimer",3e3);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(){return k.apply(this,arguments)}function k(){return(k=Object(b.a)(L.a.mark(function e(){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:w.emit("leave");case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function M(){return F.apply(this,arguments)}function F(){return(F=Object(b.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/traces_stm");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function O(e){return N.apply(this,arguments)}function N(){return(N=Object(b.a)(L.a.mark(function e(t){var a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/stops_stm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace:t})});case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(){return _.apply(this,arguments)}function _(){return(_=Object(b.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/traces_stl");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A(e){return D.apply(this,arguments)}function D(){return(D=Object(b.a)(L.a.mark(function e(t){var a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/stops_stl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace:t})});case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function H(){return V.apply(this,arguments)}function V(){return(V=Object(b.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/traces_rtl");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function B(e){return I.apply(this,arguments)}function I(){return(I=Object(b.a)(L.a.mark(function e(t){var a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/stops_rtl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trip:t})});case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q(){return z.apply(this,arguments)}function z(){return(z=Object(b.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/allvehicles");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}a(127);var J=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(n)))).state={viewport:{latitude:45.556827,longitude:-73.662362,zoom:10}},a.componentDidMount=Object(b.a)(L.a.mark(function e(){var t,r,n,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return R(function(e,t){var r=t?t[0].filter(function(e){return"STM"===e.reseau}):"",n=t?t[0].filter(function(e){return"STL"===e.reseau}):"",s=t?t[0].filter(function(e){return"RTL"===e.reseau}):"";a.setState({vehiclesSTM:r[0].data,vehiclesSTL:n[0].data,vehiclesRTL:s[0].data,timestampSTM:r[0].timestr,timestampSTL:n[0].timestr,timestampRTL:s[0].timestr,plannedTripsRTL:t?t[1]:"",plannedTripsSTL:t?t[2]:"",plannedTripsSTM:t?t[3]:""})}),t=a.reactMap.getMap(),a.handleOnLoad(t),e.next=5,M();case 5:return r=e.sent,a.setState({tracesSTM:r.rows[0].jsonb_build_object}),e.next=9,C();case 9:return n=e.sent,a.setState({tracesSTL:n.rows[0].jsonb_build_object}),e.next=13,H();case 13:s=e.sent,a.setState({tracesRTL:s.rows[0].jsonb_build_object});case 15:case"end":return e.stop()}},e)})),a.componentWillUnmount=Object(b.a)(L.a.mark(function e(){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.map.remove(),x();case 2:case"end":return e.stop()}},e)})),a.handleOnLoad=function(){var e=Object(b.a)(L.a.mark(function e(t){var r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r={type:"FeatureCollection",features:[]},t.on("load",function(){t.addSource("vehiculesSTM",{type:"geojson",data:r}),t.addSource("vehiculesSTL",{type:"geojson",data:r}),t.addSource("vehiculesRTL",{type:"geojson",data:r}),t.addSource("tracesSTM",{type:"geojson",data:r}),t.addSource("tracesSTL",{type:"geojson",data:r}),t.addSource("tracesRTL",{type:"geojson",data:r}),t.addSource("stopsSTM",{type:"geojson",data:r}),t.addSource("stopsRTL",{type:"geojson",data:r}),t.addSource("stopsSTL",{type:"geojson",data:r}),t.addSource("routeAnimRTL",{type:"geojson",data:r}),t.addLayer({id:"position-vehicules-stm",type:"symbol",source:"vehiculesSTM",layout:{"text-field":String.fromCharCode("0xF207"),"text-font":["Font Awesome 5 Free Solid"],"text-size":12},paint:{"text-color":"#009DE0"}}),t.addLayer({id:"position-vehicules-stl",type:"symbol",source:"vehiculesSTL",layout:{"text-field":String.fromCharCode("0xF207"),"text-font":["Font Awesome 5 Free Solid"],"text-size":12},paint:{"text-color":"#82C341"}}),t.addLayer({id:"position-vehicules-rtl",type:"symbol",source:"vehiculesRTL",layout:{"text-field":String.fromCharCode("0xF207"),"text-font":["Font Awesome 5 Free Solid"],"text-size":12},paint:{"text-color":"#A93332"}}),t.addLayer({id:"tracesSTM",type:"line",source:"tracesSTM",layout:{"line-join":"round","line-cap":"round",visibility:"visible"},paint:{"line-width":2,"line-color":"#2380A5"}}),t.addLayer({id:"tracesSTL",type:"line",source:"tracesSTL",layout:{"line-join":"round","line-cap":"round",visibility:"visible"},paint:{"line-width":2,"line-color":"#4A913C"}}),t.addLayer({id:"tracesRTL",type:"line",source:"tracesRTL",layout:{"line-join":"round","line-cap":"round",visibility:"visible"},paint:{"line-width":2,"line-color":"#C47B85"}}),t.addLayer({id:"stopsSTM",type:"circle",source:"stopsSTM",paint:{"circle-radius":3,"circle-color":"#009DE0"}}),t.addLayer({id:"stopsRTL",type:"circle",source:"stopsRTL",paint:{"circle-radius":3,"circle-color":"#A93332"}}),t.addLayer({id:"stopsSTL",type:"circle",source:"stopsSTL",paint:{"circle-radius":3,"circle-color":"#82C341"}}),t.addLayer({id:"routeAnimRTL",source:"routeAnimRTL",type:"line",paint:{"line-width":0,"line-color":"#007cbf"}}),a.setState({mapIsLoaded:!0})}),a.map=t;case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.componentDidUpdate=function(){var e=Object(b.a)(L.a.mark(function e(t,r){var n,s,i,c,o,l,u,p,m,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,s=n.vehiclesSTM,i=n.vehiclesSTL,c=n.vehiclesRTL,a.state.mapIsLoaded){e.next=4;break}return e.abrupt("return");case 4:s!==r.vehiclesSTM&&(a.map.getSource("vehiculesSTM").setData(s),o=a.state.vehiclesSTM?a.state.vehiclesSTM.features.map(function(e){return e.properties.route_id}):"",l=Object(T.a)(new Set(o)),a.setState({routesSTM:l})),i!==r.vehiclesSTL&&(a.map.getSource("vehiculesSTL").setData(i),u=a.state.vehiclesSTL?a.state.vehiclesSTL.features.map(function(e){return e.properties.route_id}):"",p=Object(T.a)(new Set(u)),a.setState({routesSTL:p})),c!==r.vehiclesRTL&&(a.map.getSource("vehiculesRTL").setData(c),m=a.state.vehiclesRTL?a.state.vehiclesRTL.features.map(function(e){return e.properties.route_id}):"",d=Object(T.a)(new Set(m)),a.setState({routesRTL:d}));case 7:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a._onViewportChange=function(e){return a.setState({viewport:e})},a._onHover=function(e){var t=e.features,r=e.srcEvent,n=r.offsetX,s=r.offsetY,i=t&&t.find(function(e){return"position-vehicules-stm"===e.layer.id}),c=t&&t.find(function(e){return"stopsSTM"===e.layer.id}),o=t&&t.find(function(e){return"position-vehicules-stl"===e.layer.id}),l=t&&t.find(function(e){return"position-vehicules-rtl"===e.layer.id});a.setState({hoveredFeatureSTM:i,hoveredStopSTM:c,hoveredFeatureSTL:o,hoveredFeatureRTL:l,x:n,y:s})},a.stopRequestSTM=function(){var e=Object(b.a)(L.a.mark(function e(t){var a,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return a=e.sent,r=a.rows[0].jsonb_build_object,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.stopRequestRTL=function(){var e=Object(b.a)(L.a.mark(function e(t){var a,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t);case 2:return a=e.sent,r=a.rows[0].jsonb_build_object,console.log(r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.stopRequestSTL=function(){var e=Object(b.a)(L.a.mark(function e(t){var a,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t);case 2:return a=e.sent,r=a.rows[0].jsonb_build_object,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a._onClick=function(){var e=Object(b.a)(L.a.mark(function e(t){var r,n,s,i,c,o,l,u,p,m,d,f,h,v,T,S,b,E;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.state.mapIsLoaded,n={type:"FeatureCollection",features:[]},s=t.features,i=t.srcEvent,c=i.offsetX,o=i.offsetY,l=s&&s.find(function(e){return"position-vehicules-stm"===e.layer.id}),u=s&&s.find(function(e){return"position-vehicules-stl"===e.layer.id}),p=s&&s.find(function(e){return"position-vehicules-rtl"===e.layer.id}),a.setState({clickedFeatureSTM:l,clickedFeatureSTL:u,clickedFeatureRTL:p,x:c,y:o}),m=l?l.properties.trip_id:"",d=u?u.properties.route_id:"",f=p?p.properties.trip_id:"",h=a.state.tracesSTM?a.state.tracesSTM.features.filter(function(e){return e.properties.trips.some(function(e){return e===m})}):"",v=a.state.tracesSTL?a.state.tracesSTL.features.filter(function(e){return e.properties.route_short_name===d}):"",T=a.state.tracesRTL?a.state.tracesRTL.features.filter(function(e){return e.properties.trips.some(function(e){return e===f})}):"",!0===r?""!==m?a.map.getSource("tracesSTM").setData(h[0]):a.map.getSource("tracesSTM").setData(n):"",!0===r?""!==d?a.map.getSource("tracesSTL").setData(v[0]):a.map.getSource("tracesSTL").setData(n):"",!0===r?""!==f?a.map.getSource("tracesRTL").setData(T[0]):a.map.getSource("tracesRTL").setData(n):"",""===m){e.next=22;break}return e.next=19,a.stopRequestSTM(h[0].properties.ID);case 19:e.t0=e.sent,e.next=23;break;case 22:e.t0="";case 23:if(S=e.t0,a.setState({stopsSTM:S}),!0===r?""!==a.state.stopsSTM?a.map.getSource("stopsSTM").setData(a.state.stopsSTM):a.map.getSource("stopsSTM").setData(n):"",""===f){e.next=32;break}return e.next=29,a.stopRequestRTL(f);case 29:e.t1=e.sent,e.next=33;break;case 32:e.t1="";case 33:if(b=e.t1,a.setState({stopsRTL:b}),!0===r?""!==a.state.stopsRTL?a.map.getSource("stopsRTL").setData(a.state.stopsRTL):a.map.getSource("stopsRTL").setData(n):"",""===d){e.next=42;break}return e.next=39,a.stopRequestSTL(v[0].properties.ID);case 39:e.t2=e.sent,e.next=43;break;case 42:e.t2="";case 43:E=e.t2,a.setState({stopsSTL:E}),!0===r?""!==a.state.stopsSTL?a.map.getSource("stopsSTL").setData(a.state.stopsSTL):a.map.getSource("stopsSTL").setData(n):"";case 46:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"_renderTooltip",value:function(){var e=this.state,t=e.hoveredFeatureSTM,a=(e.hoveredStopSTM,e.hoveredFeatureSTL),r=e.hoveredFeatureRTL,s=e.x,i=e.y,c=(e.mapIsLoaded,t?t.properties.trip_id:""),o=a?a.properties.route_id:"",l=r?r.properties.trip_id:"";this.state.tracesSTM&&this.state.tracesSTM.features.filter(function(e){return e.properties.trips.some(function(e){return e===c})}),this.state.tracesSTL&&this.state.tracesSTL.features.filter(function(e){return e.properties===o}),this.state.tracesRTL&&this.state.tracesRTL.features.filter(function(e){return e.properties.trips.some(function(e){return e===l})});return t?t&&n.a.createElement("div",{className:"mapToolTip",style:{left:s,top:i}},n.a.createElement("div",null,"No de v\xe9hicule: ",t.properties.vehicle_id),n.a.createElement("div",null,"Ligne: ",t.properties.route_id),n.a.createElement("div",null,"Trip: ",t.properties.trip_id),n.a.createElement("div",null,"MAJ: ",t.properties.timestamp?t.properties.timestamp:""," s")):a?a&&n.a.createElement("div",{className:"mapToolTip",style:{left:s,top:i}},n.a.createElement("div",null,"No de v\xe9hicule: ",a.properties.vehicle_id),n.a.createElement("div",null,"Ligne: ",a.properties.route_id),n.a.createElement("div",null,"MAJ : ",a.properties.last_connection," s")):r?r&&n.a.createElement("div",{className:"mapToolTip",style:{left:s,top:i}},n.a.createElement("div",null,"No de v\xe9hicule: ",r.properties.vehicle_id),n.a.createElement("div",null,"Ligne: ",r.properties.route_id),n.a.createElement("div",null,"Trip: ",r.properties.trip_id),n.a.createElement("div",null,"MAJ: ",r.properties.timestamp?r.properties.timestamp:""," s")):""}},{key:"render",value:function(){var e=this,t=this.state.viewport;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"container-fluid"},n.a.createElement(y,{lastRefreshSTM:this.state.timestampSTM?this.state.timestampSTM:"-",onlineVehiclesSTM:this.state.vehiclesSTM?this.state.vehiclesSTM.features.length:0,plannedVehiclesSTM:this.state.plannedTripsSTM?this.state.plannedTripsSTM.length:0,routesSTM:this.state.routesSTM?this.state.routesSTM.length:0,lastRefreshSTL:this.state.timestampSTL?this.state.timestampSTL:"-",onlineVehiclesSTL:this.state.vehiclesSTL?this.state.vehiclesSTL.features.length:0,plannedVehiclesSTL:this.state.plannedTripsSTL?this.state.plannedTripsSTL.length:0,routesSTL:this.state.routesSTL?this.state.routesSTL.length:0,lastRefreshRTL:this.state.timestampRTL?this.state.timestampRTL:"-",onlineVehiclesRTL:this.state.vehiclesRTL?this.state.vehiclesRTL.features.length:0,plannedVehiclesRTL:this.state.plannedTripsRTL?this.state.plannedTripsRTL.length:0,routesRTL:this.state.routesRTL?this.state.routesRTL.length:0}),n.a.createElement(E.a,Object.assign({},t,{ref:function(t){return e.reactMap=t},width:"100%",height:"85vh",mapStyle:"mapbox://styles/wdoucetk/cjun8whio1ha21fmzxt8knp7k",onViewportChange:this._onViewportChange,mapboxApiAccessToken:"pk.eyJ1Ijoid2RvdWNldGsiLCJhIjoiY2pnZnBhMjV1MHdwZjJwcWsyNGRjOGtzcCJ9.NNV1CVCSvwPa5Wb5D1Tv-Q",onHover:this._onHover,onClick:this._onClick}),this._renderTooltip())))}}]),t}(r.Component),K=a(73),G=a.n(K),P=a(14),W=a(173),Y=a(127),U=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={tripSelectRTL:0,tripListRTL:[],tripWithGraph:[],selectSTM:0,selectSTL:0,selectRTL:0},a.componentDidMount=Object(b.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return R(function(e,t){var r=t?t[0].filter(function(e){return"STM"===e.reseau}):"",n=t?t[0].filter(function(e){return"STL"===e.reseau}):"",s=t?t[0].filter(function(e){return"RTL"===e.reseau}):"",i=0;t[1].forEach(function(e){e.keyid=i,i++,s[0].data.features.filter(function(t){return t.properties.trip_id===e.tripmin}).length>0?e.online=1:e.online=0}),t[3].forEach(function(e){r[0].data.features.filter(function(t){return t.properties.trip_id===e.tripmin}).length>0?e.online=1:e.online=0});a.setState({vehiclesSTM:t?r[0].data:"",vehiclesSTL:t?n[0].data:"",vehiclesRTL:t?s[0].data:"",timestampSTM:t?r[0].time:"",timestampSTL:t?n[0].time:"",timestampRTL:t?n[0].time:"",plannedTripsRTL:t?t[1].sort(function(e,t){return e.timemin>t.timemin?1:-1}):"",plannedTripsSTL:t?t[2].sort(function(e,t){return e.timemin>t.timemin?1:-1}):"",plannedTripsSTM:t?t[3].sort(function(e,t){return e.timemin>t.timemin?1:-1}):""})}),e.next=3,H();case 3:t=e.sent,a.setState({tracesRTL:t.rows[0].jsonb_build_object}),a.state.plannedTripsRTL?a.regenGraphRTL():"";case 6:case"end":return e.stop()}},e)})),a.componentWillUnmount=Object(b.a)(L.a.mark(function e(){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:x();case 1:case"end":return e.stop()}},e)})),a.handleClickSTM=function(){var e=Object(b.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({selectSTM:1,selectSTL:0,selectRTL:0,tripSelectRTL:0});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleClickRTL=function(){var e=Object(b.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({selectSTM:0,selectSTL:0,selectRTL:1,tripSelectSTM:0});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.stopRequestRTL=function(){var e=Object(b.a)(L.a.mark(function e(t){var a,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t);case 2:return a=e.sent,r=a.rows[0].jsonb_build_object,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.regenGraphRTL=Object(b.a)(L.a.mark(function e(){var t,r,s,i,c,o,l,u,p,m,d,f;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(T.a)(a.state.tripListRTL),r=[],s=!0,i=!1,c=void 0,e.prev=5,o=t[Symbol.iterator]();case 7:if(s=(l=o.next()).done){e.next=16;break}return u=l.value,e.next=11,a.stopRequestRTL(u);case 11:p=e.sent,r.push(p);case 13:s=!0,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),i=!0,c=e.t0;case 22:e.prev=22,e.prev=23,s||null==o.return||o.return();case 25:if(e.prev=25,!i){e.next=28;break}throw c;case 28:return e.finish(25);case 29:return e.finish(22);case 30:m=Object(T.a)(a.state.plannedTripsRTL),d=0,t.forEach(function(e){var t=[];m.map(function(e){t.push(e.tripmin)});var s=t.indexOf(e),i=r[d];d++;var c=[];i.features.map(function(e){c.push({name:e.properties.name,x:e.properties.stop_sequence,y:0,z:15})});var o=a.state.vehiclesRTL.features.filter(function(t){return t.properties.trip_id===e})[0].geometry.coordinates,l=a.state.tracesRTL.features.filter(function(t){return t.properties.trips.some(function(t){return t===e})}),u=[];l[0].geometry.coordinates.map(function(e){u.push(e)});var p=Y.lineString(u),f=Y.point(o),h=Y.nearestPointOnLine(p,f,{units:"kilometers"}),v=[{x:Math.round(1e3*h.properties.location),y:0,z:60}];m.splice(s+1,0,{keyid:s+1,online:m[s].online,timemin:parseInt(m[s].timemin),timemax:m[s].timemax,tripmin:n.a.createElement(P.b,{width:"100%",height:50},n.a.createElement(P.d,null,n.a.createElement(P.f,{type:"number",dataKey:"x",hide:!0}),n.a.createElement(P.g,{type:"number",dataKey:"y",hide:!0}),n.a.createElement(P.h,{type:"number",dataKey:"z",range:[10,100],domain:[15,75]}),n.a.createElement(P.e,{cursor:{strokeDasharray:"3 3"}}),n.a.createElement(P.c,{name:"Arrets",data:c,fill:"#000000",stroke:"#5B5B5B",line:!0,shape:"circle"}),n.a.createElement(P.c,{name:"Bus",data:v,fill:"#A93332",line:!0,shape:"circle"})))})}),f=0,m.forEach(function(e){e.keyid=f,f++}),a.setState({plannedTripsWithGraphs:m});case 36:case"end":return e.stop()}},e,null,[[5,18,22,30],[23,,25,29]])})),a.addToTripList=function(){var e=Object(b.a)(L.a.mark(function e(t){var r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(r=Object(T.a)(a.state.tripListRTL)).push(t),a.setState({tripListRTL:r});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.removeFromTripList=function(){var e=Object(b.a)(L.a.mark(function e(t){var r,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(T.a)(a.state.tripListRTL),n=r.indexOf(t),r.splice(n,1),a.setState({tripListRTL:r});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleTripClickRTL=function(){var e=Object(b.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:1===a.state.plannedTripsRTL.filter(function(e){return e.tripmin===t.target.innerHTML})[0].online&&0===a.state.tripListRTL.filter(function(e){return e===t.target.innerHTML}).length?a.addToTripList(t.target.innerHTML):1===a.state.plannedTripsRTL.filter(function(e){return e.tripmin===t.target.innerHTML})[0].online&&a.state.tripListRTL.filter(function(e){return e===t.target.innerHTML}).length>0?a.removeFromTripList(t.target.innerHTML):"";case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e,t){var a=this.state,r=a.plannedTripsRTL,n=a.tripListRTL;r!==t.plannedTripsRTL&&this.regenGraphRTL(),n!==t.tripListRTL&&this.regenGraphRTL()}},{key:"render",value:function(){var e=this;return this.state.plannedTripsRTL?n.a.createElement("div",{className:"container-fluid"},n.a.createElement("div",{className:"row justify-content-center"},n.a.createElement("div",{className:"col-sm-3 mt-2 mb-2",style:{textAlign:"center",backgroundColor:"#ABFFAB"}},"Voyage actif"),n.a.createElement("div",{className:"col-sm-3 mt-2 mb-2",style:{textAlign:"center",backgroundColor:"#FFABAB"}},"Voyage inactif")),n.a.createElement("div",{className:"row"},n.a.createElement("button",{id:"agency-card",type:"button",className:"col btn btn-outline-info",style:1===this.state.selectSTM?{backgroundColor:"#38B2A3",color:"#FFFFFF"}:{backgroundColor:"#E9F1F3",color:"#000000"},onClick:function(t){return e.handleClickSTM(t)}},"STM"),n.a.createElement("button",{type:"button",className:"col btn btn-outline-secondary",disabled:!0},"STL"),n.a.createElement("button",{type:"button",className:"col btn btn-outline-info",style:1===this.state.selectRTL?{backgroundColor:"#38B2A3",color:"#FFFFFF"}:{backgroundColor:"#E9F1F3",color:"#000000"},onClick:function(t){return e.handleClickRTL(t)}},"RTL")),n.a.createElement("div",{className:"row"},n.a.createElement("table",{id:"tableOnline",className:"table"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{style:{width:"10%"}},"Ligne"),n.a.createElement("th",{style:{width:"10%"}},"Heure de d\xe9part"),n.a.createElement("th",{style:{width:"10%"}},"Heure de fin"),n.a.createElement("th",{style:{width:"70%"}},"Trip ID"))),n.a.createElement("tbody",null,1===this.state.selectRTL?this.state.plannedTripsWithGraphs.map(function(t){return n.a.createElement("tr",{key:t.keyid},n.a.createElement("td",null,t.route_id),n.a.createElement("td",null,W("2019-05-10").startOf("day").seconds(t.timemin).format("H:mm:ss")),n.a.createElement("td",null,W("2019-05-10").startOf("day").seconds(t.timemax).format("H:mm:ss")),n.a.createElement("td",{style:{backgroundColor:1===t.online?"#ABFFAB":"#FFABAB",cursor:1===t.online?"pointer":"default"},onClick:function(t){return e.handleTripClickRTL(t)}},t.tripmin))}):1===this.state.selectSTM?this.state.plannedTripsSTM.map(function(e){return n.a.createElement("tr",{key:e.tripmin},n.a.createElement("td",null,e.route_id),n.a.createElement("td",null,W("2019-05-10").startOf("day").seconds(e.timemin).format("H:mm:ss")),n.a.createElement("td",null,W("2019-05-10").startOf("day").seconds(e.timemax).format("H:mm:ss")),n.a.createElement("td",{style:{backgroundColor:1===e.online?"#ABFFAB":"#FFABAB",width:"50%"}},e.tripmin))}):n.a.createElement("tr",null,n.a.createElement("td",{colSpan:"4",style:{textAlign:"center"}}," S\xe9lectionner une agence")))))):n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"row justify-content-center"},"Chargement en cours..."),n.a.createElement("div",{className:"row justify-content-center"},n.a.createElement("div",null,n.a.createElement(G.a,{type:"bars",color:"#277D98",height:300,width:175}))))}}]),t}(r.Component),X=a(173),Z=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(n)))).state={history:null},a.componentDidMount=Object(b.a)(L.a.mark(function e(){var t,r,n,s,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:t=e.sent,r=[],t?t.forEach(function(e){r.push({reseau:e.reseau,time:parseInt(X("2019-04-28 "+e.timestr).format("x")),vehlen:e.vehlen,weekday:e.weekday,date:X(e.timestamp).format("YYYY-MM-DD")})}):"",n=r.filter(function(e){return parseInt(e.weekday)>0&&parseInt(e.weekday)<6}),s=r.filter(function(e){return 6===parseInt(e.weekday)}),i=r.filter(function(e){return 0===parseInt(e.weekday)}),a.setState({week:n,saturday:s,sunday:i});case 9:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=function(e){var t=e.active,a=e.payload;return t?n.a.createElement("div",{className:"custom-tooltip"},n.a.createElement("p",{className:"label"},"R\xe9seau : ",a[0].payload.reseau,n.a.createElement("br",null),"Date : ",a[0].payload.date," ",n.a.createElement("br",null),"Heure : ",X(a[0].payload.time).format("HH:mm:ss"),n.a.createElement("br",null),"V\xe9hicules : ",a[0].payload.vehlen)):null};return this.state.sunday?n.a.createElement("div",{className:"container-fluid"},n.a.createElement("br",null),n.a.createElement("div",{id:"chartCard"},n.a.createElement("h1",{style:{color:"#000000",textAlign:"center"}},"Semaine"),n.a.createElement(P.b,{width:"100%",height:350},n.a.createElement(P.d,{width:730,height:250,margin:{top:5,right:30,left:20,bottom:5}},n.a.createElement(P.f,{type:"number",dataKey:"time",name:"time",domain:[155642076e4,1556495999e3],tickFormatter:function(e){return X(e).format("HH:mm:ss")},ticks:[1556424000100,15564276e5,15564312e5,15564348e5,15564384e5,1556442e6,15564456e5,15564492e5,15564528e5,15564564e5,155646e7,15564636e5,15564672e5,15564708e5,15564744e5,1556478e6,15564816e5,15564852e5,15564888e5,15564924e5,1556496e6,15564996e5,15565032e5,15565068e5,1556510399900]}),n.a.createElement(P.g,{dataKey:"vehlen",name:"v\xe9hicules"}),n.a.createElement(P.h,{dataKey:"z",range:[10]}),n.a.createElement(P.e,{content:n.a.createElement(e,null)}),n.a.createElement(P.a,null),n.a.createElement(P.c,{name:"STM",data:this.state.week.filter(function(e){return"STM"===e.reseau}),fill:"#009DE0"}),n.a.createElement(P.c,{name:"STL",data:this.state.week.filter(function(e){return"STL"===e.reseau}),fill:"#82C341"}),n.a.createElement(P.c,{name:"RTL",data:this.state.week.filter(function(e){return"RTL"===e.reseau}),fill:"#A93332"})))),n.a.createElement("div",{id:"chartCard"},n.a.createElement("h1",{style:{color:"#000000",textAlign:"center"}},"Samedi"),n.a.createElement(P.b,{width:"100%",height:350},n.a.createElement(P.d,{width:730,height:250,margin:{top:5,right:30,left:20,bottom:5}},n.a.createElement(P.f,{type:"number",dataKey:"time",name:"time",domain:[155642076e4,1556495999e3],tickFormatter:function(e){return X(e).format("HH:mm:ss")},ticks:[1556424000100,15564276e5,15564312e5,15564348e5,15564384e5,1556442e6,15564456e5,15564492e5,15564528e5,15564564e5,155646e7,15564636e5,15564672e5,15564708e5,15564744e5,1556478e6,15564816e5,15564852e5,15564888e5,15564924e5,1556496e6,15564996e5,15565032e5,15565068e5,1556510399900]}),n.a.createElement(P.g,{dataKey:"vehlen",name:"v\xe9hicules"}),n.a.createElement(P.h,{dataKey:"z",range:[10]}),n.a.createElement(P.e,{content:n.a.createElement(e,null)}),n.a.createElement(P.a,null),n.a.createElement(P.c,{name:"STM",data:this.state.saturday.filter(function(e){return"STM"===e.reseau}),fill:"#009DE0"}),n.a.createElement(P.c,{name:"STL",data:this.state.saturday.filter(function(e){return"STL"===e.reseau}),fill:"#82C341"}),n.a.createElement(P.c,{name:"RTL",data:this.state.saturday.filter(function(e){return"RTL"===e.reseau}),fill:"#A93332"})))),n.a.createElement("div",{id:"chartCard"},n.a.createElement("h1",{style:{color:"#000000",textAlign:"center"}},"Dimanche"),n.a.createElement(P.b,{width:"100%",height:350},n.a.createElement(P.d,{width:500,height:250,margin:{top:5,right:30,left:20,bottom:5}},n.a.createElement(P.f,{type:"number",dataKey:"time",name:"time",domain:[155642076e4,1556495999e3],tickFormatter:function(e){return X(e).format("HH:mm:ss")},ticks:[1556424000100,15564276e5,15564312e5,15564348e5,15564384e5,1556442e6,15564456e5,15564492e5,15564528e5,15564564e5,155646e7,15564636e5,15564672e5,15564708e5,15564744e5,1556478e6,15564816e5,15564852e5,15564888e5,15564924e5,1556496e6,15564996e5,15565032e5,15565068e5,1556510399900]}),n.a.createElement(P.g,{dataKey:"vehlen",name:"v\xe9hicules"}),n.a.createElement(P.h,{dataKey:"z",range:[10]}),n.a.createElement(P.e,{content:n.a.createElement(e,null)}),n.a.createElement(P.a,null),n.a.createElement(P.c,{name:"STM",data:this.state.sunday.filter(function(e){return"STM"===e.reseau}),fill:"#009DE0"}),n.a.createElement(P.c,{name:"STL",data:this.state.sunday.filter(function(e){return"STL"===e.reseau}),fill:"#82C341"}),n.a.createElement(P.c,{name:"RTL",data:this.state.sunday.filter(function(e){return"RTL"===e.reseau}),fill:"#A93332"})))),n.a.createElement("br",null)):n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"row justify-content-center"},"Chargement en cours..."),n.a.createElement("div",{className:"row justify-content-center"},n.a.createElement("div",null,n.a.createElement(G.a,{type:"bars",color:"#277D98",height:300,width:175}))))}}]),t}(r.Component),Q=function(){return n.a.createElement(h.c,null,n.a.createElement(h.a,{exact:!0,path:"/",component:J}),n.a.createElement(h.a,{exact:!0,path:"/historique",component:Z}),n.a.createElement(h.a,{exact:!0,path:"/livetrips",component:U}),n.a.createElement(h.a,{path:"*",component:v}))},$=(a(436),function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(d,null),n.a.createElement("main",{id:"app"},n.a.createElement(Q,null)),n.a.createElement(f,null))}}]),t}(r.Component));i.a.render(n.a.createElement(c.a,null,n.a.createElement($,null)),document.getElementById("root"))}},[[213,1,2]]]);
//# sourceMappingURL=main.f354bb96.chunk.js.map