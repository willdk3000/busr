{"version":3,"sources":["components/Header.js","components/Footer.js","components/NotFound.js","components/StatCards.js","API.js","helpers/AnimationHelper.js","containers/Livemap.js","containers/Livetrips.js","containers/Historique.js","components/Routes.js","App.js","index.js"],"names":["Header","react_default","a","createElement","Fragment","id","className","type","data-toggle","data-target","aria-controls","aria-expanded","aria-label","style","color","react_router_dom","to","textDecoration","Footer","NotFound","StatCards","this","props","lastRefreshSTM","substr","onlineVehiclesSTM","plannedVehiclesSTM","routesSTM","lastRefreshSTL","onlineVehiclesSTL","plannedVehiclesSTL","routesSTL","lastRefreshRTL","onlineVehiclesRTL","plannedVehiclesRTL","routesRTL","Component","socket","io","connect","transports","getNewData","_x","_getNewData","apply","arguments","_callee","cb","regenerator_default","wrap","_context","prev","next","on","data","emit","stop","getTracesSTM","_getTracesSTM","_callee2","response","_context2","fetch","sent","abrupt","json","getStopsSTM","_x2","_getStopsSTM","_callee3","trace","_context3","method","headers","Content-Type","body","JSON","stringify","getTracesSTL","_getTracesSTL","_callee4","_context4","getStopsSTL","_x3","_getStopsSTL","_callee5","_context5","getTracesRTL","_getTracesRTL","_callee6","_context6","getStopsRTL","_x4","_getStopsRTL","_callee7","_context7","getHistory","_getHistory","_callee8","_context8","require","Livemap","state","subscribed","viewport","latitude","longitude","zoom","componentDidMount","map","tracesSTM","tracesSTL","tracesRTL","_this","err","positions","vehSTM","filter","e","reseau","vehSTL","vehRTL","setState","vehiclesSTM","vehiclesSTL","vehiclesRTL","timestampSTM","timestr","timestampSTL","timestampRTL","plannedTripsRTL","plannedTripsSTL","plannedTripsSTM","reactMap","getMap","handleOnLoad","rows","jsonb_build_object","emptyGeoJSON","features","addSource","addLayer","source","layout","text-field","String","fromCharCode","text-font","text-size","paint","text-color","line-join","line-cap","visibility","line-width","line-color","circle-radius","circle-color","mapIsLoaded","componentDidUpdate","prevProps","prevState","_this$state","vehRoutesSTM","uniqueRoutesSTM","vehRoutesSTL","uniqueRoutesSTL","vehRoutesRTL","uniqueRoutesRTL","getSource","setData","properties","route_id","Object","toConsumableArray","Set","localStorage","setItem","console","log","componentWillUnmount","remove","_onViewportChange","_onHover","event","_event$srcEvent","srcEvent","offsetX","offsetY","hoveredFeatureSTM","find","f","layer","hoveredStopSTM","hoveredFeatureSTL","hoveredFeatureRTL","x","y","stopRequestSTM","stopsResponseSTM","parseStopsSTM","stopRequestRTL","stopsResponseRTL","parseStopsRTL","stopRequestSTL","stopsResponseSTL","parseStopsSTL","_onClick","_event$srcEvent2","clickedFeatureSTM","clickedFeatureSTL","clickedFeatureRTL","tripClickSTM","routeClickSTL","tripClickRTL","traceSTM","traceSTL","traceRTL","stopsSTM","stopsRTL","stopsSTL","trip_id","trips","some","route_short_name","ID","t0","t1","t2","_this$state2","tripHoverSTM","routeHoverSTL","tripHoverRTL","nomLigneRTL","left","top","vehicle_id","timestamp","last_connection","route_name","_this2","components_StatCards","length","esm","assign","ref","width","height","mapStyle","onViewportChange","mapboxApiAccessToken","process","onHover","onClick","_renderTooltip","moment","Livetrips","selectSTM","selectSTL","selectRTL","forEach","tripmin","online","time","handleClickSTM","handleClickRTL","backgroundColor","disabled","sort","b","timemin","key","startOf","seconds","format","timemax","colspan","textAlign","Historique","history","allVehicles","parseAll","week","saturday","sunday","push","parseInt","vehlen","weekday","CustomTooltip","_ref2","active","payload","es6","margin","right","bottom","dataKey","name","domain","tickFormatter","unixTime","ticks","range","content","fill","Routes","react_router","exact","path","component","App","components_Header","components_Routes","components_Footer","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.4e8dd439.chunk.js","sourcesContent":["import React from 'react';\nimport { Link } from 'react-router-dom';\n\nconst Header = () => (\n\n  <React.Fragment>\n\n    <div id=\"headnav\" className=\"container-fluid\">\n      <nav className=\"navbar navbar-expand-md\">\n        <p className=\"navbar-brand mb-0 h1 text-white\"><i className=\"fas fa-rss\"></i> busr</p>\n        <button className=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarNavAltMarkup\" aria-controls=\"navbarNavAltMarkup\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n          <i className=\"fas fa-bars\" style={{ color: '#FFFFFF' }}></i>\n        </button>\n        <div className=\"collapse navbar-collapse\" id=\"navbarNavAltMarkup\">\n          <div className=\"navbar-nav\">\n            <Link className=\"nav-item nav-link text-white\" to=\"/\" style={{ textDecoration: 'none', color: '#FFFFFF' }}>\n              Carte\n            </Link>\n            <Link className=\"nav-item nav-link text-white\" to=\"/historique\" style={{ textDecoration: 'none', color: '#FFFFFF' }}>\n              Historique\n            </Link>\n            <Link className=\"nav-item nav-link text-white\" to=\"/livetrips\" style={{ textDecoration: 'none', color: '#FFFFFF' }}>\n              Départs\n            </Link>\n            {/*<Link className=\"nav-item nav-link text-white\" to=\"/reseaux\" style={{ textDecoration: 'none', color: '#FFFFFF' }}>\n              Réseaux\n            </Link>*/}\n          </div>\n        </div>\n      </nav>\n    </div>\n\n  </React.Fragment>\n);\n\nexport default Header;","import React from 'react';\n\nconst Footer = () => (\n  <div className=\"container-fluid\">\n    <nav className=\"navbar sticky-bottom navbar-light bg-light\">\n      <span className=\"navbar-brand\">&copy; busr 2019</span>\n    </nav>\n  </div>\n);\n\nexport default Footer;","import React from 'react';\n\nconst NotFound = () => (\n    <div className=\"container-fluid\">\n        <div className=\"jumbotron\">\n            <div className=\"container\">\n                <h1 className=\"display-4\">Page introuvable...</h1>\n                <p className=\"lead\">La page recherchée n'est pas disponible.</p>\n            </div>\n        </div>\n    </div>\n)\n\nexport default NotFound;","import React, { Component } from 'react';\n\nclass StatCards extends Component {\n  render() {\n    return (\n      <React.Fragment>\n        <div className=\"container-fluid\">\n          <div className=\"row\">\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Réseau :</div>\n              <div id='stat'>STM</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>API :</div>\n              <div id='stat'>gtfs-r</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Rafraîchit à :</div>\n              <div id='stat'>{this.props.lastRefreshSTM.substr(0, 8)}</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Véhicules actifs / planifiés :</div>\n              <div id='stat'>{this.props.onlineVehiclesSTM} / {this.props.plannedVehiclesSTM}</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Lignes en service :</div>\n              <div id='stat'>{this.props.routesSTM}</div>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Réseau :</div>\n              <div id='stat'>STL</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>API :</div>\n              <div id='stat'>nextbus</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Rafraîchit à :</div>\n              <div id='stat'>{this.props.lastRefreshSTL.substr(0, 8)}</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Véhicules actifs / planifiés :</div>\n              <div id='stat'>{this.props.onlineVehiclesSTL} / {this.props.plannedVehiclesSTL}</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Lignes en service :</div>\n              <div id='stat'>{this.props.routesSTL}</div>\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Réseau :</div>\n              <div id='stat'>RTL</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>API :</div>\n              <div id='stat'>gtfs-r</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Rafraîchit à :</div>\n              <div id='stat'>{this.props.lastRefreshRTL.substr(0, 8)}</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Véhicules actifs / planifiés :</div>\n              <div id='stat'>{this.props.onlineVehiclesRTL} / {this.props.plannedVehiclesRTL}</div>\n            </div>\n            <div className=\"col-sm\" id=\"stat-card\">\n              <div id='nom-stat'>Lignes en service :</div>\n              <div id='stat'>{this.props.routesRTL}</div>\n            </div>\n          </div>\n        </div>\n      </React.Fragment >\n    );\n  }\n}\n\nexport default StatCards;","import io from \"socket.io-client\";\n//const API_URL = process.env.NODE_ENV ? window.location.hostname : 'http://192.168.0.146:5000'\n//Pour mobile, l'adresse ci-dessous doit etre le IP et non localhost\n\n// const socket = process.env.HEROKU ?\n//   io.connect('window.location.hostname', { transports: ['websocket'] })\n//   : io.connect('http://localhost:5000', { transports: ['websocket'] });\n\n//const socket = io.connect('http://localhost:5000', { transports: ['websocket'] });\nconst socket = io.connect('busr-mtl.herokuapp.com', { transports: ['websocket'] });\n\nexport async function getNewData(cb) {\n\n  // socket.on('message-client-connected', (message) => {\n  //   console.log(message)\n  // })\n\n  socket.on('refresh data', data => cb(null, data))\n\n  socket.emit('subscribeToTimer', 5000);\n\n}\n\nexport function closeSocket() {\n  socket.disconnect()\n}\n\n\n// Donnees pour cartographie\nexport async function getTracesSTM() {\n  const response = await fetch('/api/traces_stm')\n  return response.json();\n};\n\n\nexport async function getStopsSTM(trace) {\n  const response = await fetch('/api/stops_stm', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ \"trace\": trace })\n  });\n  return response.json()\n}\n\n\nexport async function getTracesSTL() {\n  const response = await fetch('/api/traces_stl');\n  return response.json();\n};\n\nexport async function getStopsSTL(trace) {\n  const response = await fetch('/api/stops_stl', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ \"trace\": trace })\n  });\n  return response.json()\n}\n\n\nexport async function getTracesRTL() {\n  const response = await fetch('/api/traces_rtl');\n  return response.json();\n};\n\n\nexport async function getStopsRTL(trace) {\n  const response = await fetch('/api/stops_rtl', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ \"trace\": trace })\n  });\n  return response.json()\n}\n\n\n// Donnees pour graphiques\n\nexport async function getHistory() {\n  const response = await fetch('/api/allvehicles')\n  return response.json()\n};\n\n\n","const turf = require('@turf/turf');\n\nexport async function tripsToArcsRTL(pointsDepart, pointsArrivee, shapes) {\n\n  //POUR L'INSTANT, NE TIENT PAS COMPTE DES POINTS POUR LESQUELS ON AURAIT \n  //SEULEMENT LE DEPART OU SEULEMENT L'ARRIVEE\n\n  // Step 1 : put each active shape in shape array\n  //let emptyGeoJSON = { \"type\": \"FeatureCollection\", \"features\": [] }\n  let shapeArray = [];\n\n  const buildShapeArray = shapes ? pointsDepart.features.forEach((e) => {\n    if (pointsArrivee.features.filter((f) => {\n      return f.properties.trip_id === e.properties.trip_id\n    }).length > 0) {\n      shapeArray.push(shapes.features.filter((f) => {\n        return f.properties.trips.some((g) => {\n          return g === e.properties.trip_id\n        })\n      }))\n    } //else {\n    //shapeArray.push(emptyGeoJSON)\n    //}\n  }) : ''\n  //console.log(shapeArray);\n\n  // Step 2 : slice shapes between start and stop\n  let i = 0;\n  let start = [];\n  let stop = [];\n  let line = [];\n  let slicedShapes = [];\n\n  //console.log(shapeArray[1]);\n\n  shapeArray.forEach((e) => {\n    start = turf.point(pointsDepart.features[i].geometry.coordinates);\n    stop = turf.point(pointsArrivee.features[i].geometry.coordinates);\n    line = turf.lineString(e[0].geometry.coordinates);\n    slicedShapes.push(turf.lineSlice(start, stop, line));\n    i++;\n  })\n\n  //console.log(slicedShapes)\n\n  // Step 3 : calculate sliced shape distances \n  //CES DISTANCES PEUVENT ETRE UTILISEES POUR CALCULER LA VITESSE\n\n  i = 0;\n  let sliceDistances = [];\n  slicedShapes.forEach((e) => {\n    sliceDistances.push(turf.lineDistance(slicedShapes[i]));\n    i++;\n  })\n\n  //console.log(sliceDistances)\n\n  // Step 4 : break shapes into segments based on number of steps\n  // 5m / step\n\n  let arc = [];\n  let j = 0;\n\n  slicedShapes.forEach((e) => {\n    for (let i = 0; i < sliceDistances[j]; i += sliceDistances[j] / (sliceDistances[j] / 5)) {\n      let line = turf.lineString(slicedShapes[j].geometry.coordinates);\n      let segment = turf.along(line, i);\n      arc.push(segment.geometry.coordinates);\n    }\n    slicedShapes[j].geometry.coordinates = arc;\n    j++;\n  })\n\n  return slicedShapes;\n\n}\n\n\n// Fonction d'animation \n\nexport async function animate(map, pointsDepart, arcs, featureIdx, cntr) {\n  // Update point geometry to a new position based on counter denoting\n  // the index to access the arc.\n  if (cntr >= arcs[featureIdx].geometry.coordinates.length - 1) {\n    return;\n  }\n\n  pointsDepart[featureIdx].geometry.coordinates = pointsDepart[featureIdx].geometry.coordinates[cntr];\n\n\n  pointsDepart[featureIdx].properties.bearing = turf.bearing(\n    turf.point(arcs[featureIdx].geometry.coordinates[cntr >= arcs[featureIdx].geometry.coordinates.length ? cntr - 1 : cntr]),\n    turf.point(arcs[featureIdx].geometry.coordinates[cntr >= arcs[featureIdx].geometry.coordinates.length ? cntr : cntr + 1])\n  );\n\n  // Update the source with this new data.\n  map.getSource('vehiculesRTL').setData(pointsDepart);\n\n  // Request the next frame of animation so long the end has not been reached.\n  if (cntr < arcs[featureIdx].geometry.coordinates.length) {\n    requestAnimationFrame(function () { animate(featureIdx, cntr + 1); });\n  }\n\n}","import React, { Component } from 'react';\nimport MapGL from 'react-map-gl';\nimport moment from 'moment-timezone';\nimport StatCards from '../components/StatCards.js'\n\nimport {\n  getNewData, closeSocket,\n  getTracesSTM, getTracesSTL, getTracesRTL,\n  getStopsSTM, getStopsRTL, getStopsSTL\n} from '../API.js'\n\nimport {\n  tripsToArcsRTL, animate\n} from '../helpers/AnimationHelper.js'\n\nclass Livemap extends Component {\n\n  state = {\n    subscribed: 0,\n    viewport: {\n      latitude: 45.556827,\n      longitude: -73.662362,\n      zoom: 10\n    }\n  };\n\n  componentDidMount = async () => {\n\n    const getData = this.state.subscribed === 0 ?\n      getNewData((err, positions) => {\n\n        const vehSTM = positions ? positions[0].filter((e) => {\n          return e.reseau === 'STM'\n        }) : ''\n\n        const vehSTL = positions ? positions[0].filter((e) => {\n          return e.reseau === 'STL'\n        }) : ''\n\n        const vehRTL = positions ? positions[0].filter((e) => {\n          return e.reseau === 'RTL'\n        }) : ''\n\n        this.setState({\n          vehiclesSTM: positions ? vehSTM[0].data : '',\n          vehiclesSTL: positions ? vehSTL[0].data : '',\n          vehiclesRTL: positions ? vehRTL[0].data : '',\n          timestampSTM: positions ? vehSTM[0].timestr : '',\n          timestampSTL: positions ? vehSTL[0].timestr : '',\n          timestampRTL: positions ? vehRTL[0].timestr : '',\n          subscribed: 1,\n          plannedTripsRTL: positions ? positions[1] : '',\n          plannedTripsSTL: positions ? positions[2] : '',\n          plannedTripsSTM: positions ? positions[3] : ''\n        })\n\n      })\n      : '';\n\n    const map = this.reactMap.getMap();\n\n    //initialisation de la carte\n    this.handleOnLoad(map)\n\n    const tracesSTM = await getTracesSTM();\n    this.setState({\n      tracesSTM: tracesSTM.rows[0].jsonb_build_object\n    })\n\n    const tracesSTL = await getTracesSTL();\n    this.setState({\n      tracesSTL: tracesSTL.rows[0].jsonb_build_object\n    })\n\n    const tracesRTL = await getTracesRTL();\n    this.setState({\n      tracesRTL: tracesRTL.rows[0].jsonb_build_object\n    })\n\n\n  }\n\n\n  handleOnLoad = async (map) => {\n    let emptyGeoJSON = { \"type\": \"FeatureCollection\", \"features\": [] }\n\n    map.on('load', () => {\n\n      //mettre un geojson valide (mais vide) sur la carte a l'initialisation pour eviter que mapbox \n      //genere une erreur. comment c'est monte ici, la source 'vehicules' est chargee au moment\n      //ou la carte finit de charger. pour que la source soit valide, elle doit contenir au \n      //un geojson valide.\n\n      // Sources Vehicules\n      map.addSource(\n        \"vehiculesSTM\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      map.addSource(\n        \"vehiculesSTL\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      map.addSource(\n        \"vehiculesRTL\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      // Sources Traces\n      map.addSource(\n        \"tracesSTM\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      map.addSource(\n        \"tracesSTL\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      map.addSource(\n        \"tracesRTL\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      // Sources Stops\n      map.addSource(\n        \"stopsSTM\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      map.addSource(\n        \"stopsRTL\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      map.addSource(\n        \"stopsSTL\", {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        }\n      );\n\n      // Sources shapes ANIM\n      map.addSource(\n        'routeAnimRTL', {\n          \"type\": \"geojson\",\n          \"data\": emptyGeoJSON\n        });\n\n      //ajout de la couche de vehicules (basee sur la source vehicules)\n      //pour les icones de bus, s'assurer de mettre le type symbol\n      //le code 0xF207 s'explique comme suit :\n      //0x caracteres a ajouter pour tous les icones\n      //F207 identifiant de l'icone bus de fontawesome\n      //la police FontAwesome doit avoir ete chargee dans une des couches du style de carte utilise\n      //voir mapboxstudio\n\n      // Couches vehicules\n      map.addLayer(\n        {\n          \"id\": \"position-vehicules-stm\",\n          \"type\": \"symbol\",\n          \"source\": \"vehiculesSTM\",\n          \"layout\": {\n            'text-field': String.fromCharCode(\"0xF207\"),\n            'text-font': ['Font Awesome 5 Free Solid'],\n            'text-size': 12\n          },\n          \"paint\": {\n            \"text-color\": \"#009DE0\"\n          }\n        }\n      );\n\n      map.addLayer(\n        {\n          \"id\": \"position-vehicules-stl\",\n          \"type\": \"symbol\",\n          \"source\": \"vehiculesSTL\",\n          \"layout\": {\n            'text-field': String.fromCharCode(\"0xF207\"),\n            'text-font': ['Font Awesome 5 Free Solid'],\n            'text-size': 12\n          },\n          \"paint\": {\n            \"text-color\": \"#82C341\"\n          }\n        }\n      );\n\n      map.addLayer(\n        {\n          \"id\": \"position-vehicules-rtl\",\n          \"type\": \"symbol\",\n          \"source\": \"vehiculesRTL\",\n          \"layout\": {\n            'text-field': String.fromCharCode(\"0xF207\"),\n            'text-font': ['Font Awesome 5 Free Solid'],\n            'text-size': 12\n          },\n          \"paint\": {\n            \"text-color\": \"#A93332\"\n          }\n        }\n      );\n\n      // Couches traces\n      map.addLayer({\n        \"id\": \"tracesSTM\",\n        \"type\": \"line\",\n        \"source\": \"tracesSTM\",\n        \"layout\": {\n          \"line-join\": \"round\",\n          \"line-cap\": \"round\",\n          \"visibility\": \"visible\"\n        },\n        \"paint\": {\n          \"line-width\": 2,\n          \"line-color\": \"#2380A5\"\n        }\n      });\n\n      map.addLayer({\n        \"id\": \"tracesSTL\",\n        \"type\": \"line\",\n        \"source\": \"tracesSTL\",\n        \"layout\": {\n          \"line-join\": \"round\",\n          \"line-cap\": \"round\",\n          \"visibility\": \"visible\"\n        },\n        \"paint\": {\n          \"line-width\": 2,\n          \"line-color\": \"#4A913C\"\n        }\n      });\n\n      map.addLayer({\n        \"id\": \"tracesRTL\",\n        \"type\": \"line\",\n        \"source\": \"tracesRTL\",\n        \"layout\": {\n          \"line-join\": \"round\",\n          \"line-cap\": \"round\",\n          \"visibility\": \"visible\"\n        },\n        \"paint\": {\n          \"line-width\": 2,\n          \"line-color\": \"#C47B85\"\n        }\n      });\n\n      // Couches Stops\n      map.addLayer(\n        {\n          \"id\": \"stopsSTM\",\n          \"type\": \"circle\",\n          \"source\": \"stopsSTM\",\n          \"paint\": {\n            \"circle-radius\": 3,\n            \"circle-color\": \"#009DE0\"\n          }\n        }\n      );\n\n      map.addLayer(\n        {\n          \"id\": \"stopsRTL\",\n          \"type\": \"circle\",\n          \"source\": \"stopsRTL\",\n          \"paint\": {\n            \"circle-radius\": 3,\n            \"circle-color\": \"#A93332\"\n          }\n        }\n      );\n\n      map.addLayer(\n        {\n          \"id\": \"stopsSTL\",\n          \"type\": \"circle\",\n          \"source\": \"stopsSTL\",\n          \"paint\": {\n            \"circle-radius\": 3,\n            \"circle-color\": \"#82C341\"\n          }\n        }\n      );\n\n      // Couches route ANIM\n\n      map.addLayer({\n        \"id\": \"routeAnimRTL\",\n        \"source\": \"routeAnimRTL\",\n        \"type\": \"line\",\n        \"paint\": {\n          \"line-width\": 0,\n          \"line-color\": \"#007cbf\"\n        }\n      });\n\n      this.setState({ mapIsLoaded: true });\n\n    })\n\n    this.map = map;\n  }\n\n\n  //rafraichir les donnees avec les nouvelles donnees recues de socketio\n  //au moment du update du component\n  componentDidUpdate = async (prevProps, prevState) => {\n    const { vehiclesSTM, vehiclesSTL, vehiclesRTL } = this.state;\n    const { mapIsLoaded } = this.state;\n\n    if (!mapIsLoaded) {\n      return;\n    }\n\n    // Gestion vehicules STM\n    if (vehiclesSTM !== prevState.vehiclesSTM) {\n      this.map.getSource(\"vehiculesSTM\").setData(vehiclesSTM);\n\n      const vehRoutesSTM = this.state.vehiclesSTM ? this.state.vehiclesSTM.features.map((e) => {\n        return e.properties.route_id\n      }) : ''\n\n      const uniqueRoutesSTM = [...new Set(vehRoutesSTM)]\n\n      this.setState({ routesSTM: uniqueRoutesSTM })\n\n      localStorage.setItem('data', this.state)\n    }\n\n    // Gestion vehicules STL\n    if (vehiclesSTL !== prevState.vehiclesSTL) {\n      this.map.getSource(\"vehiculesSTL\").setData(vehiclesSTL);\n\n      const vehRoutesSTL = this.state.vehiclesSTL ? this.state.vehiclesSTL.features.map((e) => {\n        return e.properties.route_id\n      }) : ''\n\n      const uniqueRoutesSTL = [...new Set(vehRoutesSTL)]\n\n      this.setState({ routesSTL: uniqueRoutesSTL })\n    }\n\n    // Gestion vehicules RTL\n    if (vehiclesRTL !== prevState.vehiclesRTL) {\n      this.map.getSource(\"vehiculesRTL\").setData(vehiclesRTL);\n\n      const vehRoutesRTL = this.state.vehiclesRTL ? this.state.vehiclesRTL.features.map((e) => {\n        return e.properties.route_id\n      }) : ''\n\n      const uniqueRoutesRTL = [...new Set(vehRoutesRTL)]\n\n      // Animation\n      // if (prevState.vehiclesRTL && this.state.vehiclesRTL) {\n      //   const arcsRTL = await tripsToArcsRTL(prevState.vehiclesRTL, this.state.vehiclesRTL, this.state.tracesRTL);\n\n      //   // console.log(arcsRTL)\n      //   // console.log(prevState.vehiclesRTL.features)\n\n      //   // let i = 0;\n      //   // prevState.vehiclesRTL.features.forEach((e) => {\n      //   //   animate(this.map, prevState.vehiclesRTL.features, arcsRTL, i, 0)\n      //   //   i++\n      //   // })\n\n      // }\n\n      this.setState({ routesRTL: uniqueRoutesRTL })\n\n    }\n\n    console.log(this.state)\n\n  }\n\n\n\n  componentWillUnmount = async () => {\n    this.map.remove();\n    //closeSocket();\n  }\n\n\n  _onViewportChange = viewport => this.setState({ viewport });\n\n\n  _onHover = event => {\n    const { features, srcEvent: { offsetX, offsetY } } = event;\n\n    const hoveredFeatureSTM = features && features.find(f => f.layer.id === 'position-vehicules-stm');\n    const hoveredStopSTM = features && features.find(f => f.layer.id === 'stopsSTM');\n\n    const hoveredFeatureSTL = features && features.find(f => f.layer.id === 'position-vehicules-stl');\n\n    const hoveredFeatureRTL = features && features.find(f => f.layer.id === 'position-vehicules-rtl');\n\n    this.setState({\n      hoveredFeatureSTM,\n      hoveredStopSTM,\n      hoveredFeatureSTL,\n      hoveredFeatureRTL,\n      x: offsetX,\n      y: offsetY\n    });\n\n  };\n\n\n\n  stopRequestSTM = async (trace) => {\n    const stopsResponseSTM = await getStopsSTM(trace);\n    const parseStopsSTM = stopsResponseSTM.rows[0].jsonb_build_object\n    return parseStopsSTM\n  }\n\n  stopRequestRTL = async (trace) => {\n    const stopsResponseRTL = await getStopsRTL(trace);\n    const parseStopsRTL = stopsResponseRTL.rows[0].jsonb_build_object\n    return parseStopsRTL\n  }\n\n  stopRequestSTL = async (trace) => {\n    const stopsResponseSTL = await getStopsSTL(trace);\n    const parseStopsSTL = stopsResponseSTL.rows[0].jsonb_build_object\n    return parseStopsSTL\n  }\n\n\n  _onClick = async (event) => {\n\n    const { mapIsLoaded } = this.state;\n\n    let emptyGeoJSON = { \"type\": \"FeatureCollection\", \"features\": [] }\n\n    const { features, srcEvent: { offsetX, offsetY } } = event;\n    const clickedFeatureSTM = features && features.find(f => f.layer.id === 'position-vehicules-stm');\n    const clickedFeatureSTL = features && features.find(f => f.layer.id === 'position-vehicules-stl');\n    const clickedFeatureRTL = features && features.find(f => f.layer.id === 'position-vehicules-rtl');\n\n    this.setState({\n      clickedFeatureSTM,\n      clickedFeatureSTL,\n      clickedFeatureRTL,\n      x: offsetX,\n      y: offsetY\n    });\n\n    // Identification du trip (stm, rtl) ou de la ligne (stl) cliqué\n    const tripClickSTM = clickedFeatureSTM ? clickedFeatureSTM.properties.trip_id : '';\n    const routeClickSTL = clickedFeatureSTL ? clickedFeatureSTL.properties.route_id : '';\n    const tripClickRTL = clickedFeatureRTL ? clickedFeatureRTL.properties.trip_id : '';\n\n    // Détermination du shape à faire apparaître en fonction du trip ou de la ligne cliqué.\n    const traceSTM = this.state.tracesSTM ? this.state.tracesSTM.features.filter((e) => {\n      return e.properties.trips.some((f) => {\n        return f === tripClickSTM\n      })\n    }) : ''\n\n    const traceSTL = this.state.tracesSTL ? this.state.tracesSTL.features.filter((e) => {\n      return e.properties.route_short_name === routeClickSTL\n    }) : ''\n\n    const traceRTL = this.state.tracesRTL ? this.state.tracesRTL.features.filter((e) => {\n      return e.properties.trips.some((f) => {\n        return f === tripClickRTL\n      })\n    }) : ''\n\n    // Affichage de la trace\n    const clickTraceSTM = mapIsLoaded === true ? (tripClickSTM !== '' ? this.map.getSource(\"tracesSTM\").setData(traceSTM[0])\n      : this.map.getSource(\"tracesSTM\").setData(emptyGeoJSON))\n      : '';\n\n    const clickTraceSTL = mapIsLoaded === true ? (routeClickSTL !== '' ? this.map.getSource(\"tracesSTL\").setData(traceSTL[0])\n      : this.map.getSource(\"tracesSTL\").setData(emptyGeoJSON))\n      : '';\n\n    const clickTraceRTL = mapIsLoaded === true ? (tripClickRTL !== '' ? this.map.getSource(\"tracesRTL\").setData(traceRTL[0])\n      : this.map.getSource(\"tracesRTL\").setData(emptyGeoJSON))\n      : '';\n\n    //Requete pour obtenir les arrets a afficher selon le trip (ou la route)\n    const stopsSTM = tripClickSTM !== '' ? await this.stopRequestSTM(traceSTM[0].properties.ID) : '';\n    this.setState({ stopsSTM: stopsSTM })\n\n\n    const clickStopsSTM = mapIsLoaded === true ? (this.state.stopsSTM !== '' ? this.map.getSource(\"stopsSTM\").setData(this.state.stopsSTM)\n      : this.map.getSource(\"stopsSTM\").setData(emptyGeoJSON))\n      : '';\n\n    const stopsRTL = tripClickRTL !== '' ? await this.stopRequestRTL(traceRTL[0].properties.ID) : '';\n    this.setState({ stopsRTL: stopsRTL })\n\n\n    const clickStopsRTL = mapIsLoaded === true ? (this.state.stopsRTL !== '' ? this.map.getSource(\"stopsRTL\").setData(this.state.stopsRTL)\n      : this.map.getSource(\"stopsRTL\").setData(emptyGeoJSON))\n      : '';\n\n    const stopsSTL = routeClickSTL !== '' ? await this.stopRequestSTL(traceSTL[0].properties.ID) : '';\n    this.setState({ stopsSTL: stopsSTL })\n\n\n    const clickStopsSTL = mapIsLoaded === true ? (this.state.stopsSTL !== '' ? this.map.getSource(\"stopsSTL\").setData(this.state.stopsSTL)\n      : this.map.getSource(\"stopsSTL\").setData(emptyGeoJSON))\n      : '';\n\n\n\n  };\n\n\n  _renderTooltip() {\n\n    const {\n      hoveredFeatureSTM,\n      hoveredStopSTM,\n      hoveredFeatureSTL,\n      hoveredFeatureRTL,\n      x, y, mapIsLoaded } = this.state;\n\n\n\n    // Identification du trip (stm, rtl) ou de la ligne (stl) hovered\n    const tripHoverSTM = hoveredFeatureSTM ? hoveredFeatureSTM.properties.trip_id : '';\n    const routeHoverSTL = hoveredFeatureSTL ? hoveredFeatureSTL.properties.route_id : '';\n    const tripHoverRTL = hoveredFeatureRTL ? hoveredFeatureRTL.properties.trip_id : '';\n\n\n    //Affectation du nom du trip ou de la ligne à une variable \n    const nomLigneSTM = this.state.tracesSTM ? this.state.tracesSTM.features.filter((e) => {\n      return e.properties.trips.some((f) => {\n        return f === tripHoverSTM\n      })\n    }) : ''\n\n    const nomLigneSTL = this.state.tracesSTL ? this.state.tracesSTL.features.filter((e) => {\n      return e.properties === routeHoverSTL\n    }) : ''\n\n    const nomLigneRTL = this.state.tracesRTL ? this.state.tracesRTL.features.filter((e) => {\n      return e.properties.trips.some((f) => {\n        return f === tripHoverRTL\n      })\n    }) : ''\n\n\n\n    //AFFICHAGE DES TOOLTIP ON HOVER\n\n    return hoveredFeatureSTM ?\n      hoveredFeatureSTM && (\n        //ne pas appeler la class 'tooltip' car il semble que ce nom soit en conflit\n        //avec un autre tooltip...\n        <div className=\"mapToolTip\" style={{ left: x, top: y }}>\n          <div>No de véhicule: {hoveredFeatureSTM.properties.vehicle_id}</div>\n          <div>Ligne: {hoveredFeatureSTM.properties.route_id}</div>\n          {/*<div>Axe: {nomLigneSTM[0].properties.route_name ? nomLigneSTM[0].properties.route_name : ''}</div>*/}\n          <div>Trip: {hoveredFeatureSTM.properties.trip_id}</div>\n          <div>MAJ: {hoveredFeatureSTM.properties.timestamp ? hoveredFeatureSTM.properties.timestamp : ''} s</div>\n        </div>\n      ) :\n      hoveredFeatureSTL ?\n        hoveredFeatureSTL && (\n          <div className=\"mapToolTip\" style={{ left: x, top: y }}>\n            <div>No de véhicule: {hoveredFeatureSTL.properties.vehicle_id}</div>\n            <div>Ligne: {hoveredFeatureSTL.properties.route_id}</div>\n            <div>MAJ : {hoveredFeatureSTL.properties.last_connection} s</div>\n          </div>\n        ) :\n        hoveredFeatureRTL ?\n          hoveredFeatureRTL && (\n            <div className=\"mapToolTip\" style={{ left: x, top: y }}>\n              <div>No de véhicule: {hoveredFeatureRTL.properties.vehicle_id}</div>\n              <div>Ligne: {hoveredFeatureRTL.properties.route_id}</div>\n              <div>Axe: {nomLigneRTL ? nomLigneRTL[0].properties.route_name : ''}</div>\n              <div>Trip: {hoveredFeatureRTL.properties.trip_id}</div>\n              <div>MAJ: {hoveredFeatureRTL.properties.timestamp ? hoveredFeatureRTL.properties.timestamp : ''} s</div>\n            </div>\n          ) : ''\n    /*hoveredStopSTM ?\n      hoveredStopSTM && (\n        <div className=\"mapToolTip\" style={{ left: x, top: y }}>\n          <div>Passages :{this.hoveredStopSTM ? this.stopSTM.features.filter((e) => {\n            return e.id === parseInt(this.state.hoveredStopsSTM.id)\n          }).properties.departs.map((e) => { return e })\n            : ''}</div>\n        </div>\n      ) : ''*/\n\n  }\n\n\n  render() {\n\n    const { viewport } = this.state;\n\n    return <React.Fragment >\n      <div className=\"container-fluid\">\n        <StatCards\n          lastRefreshSTM={this.state.timestampSTM ? this.state.timestampSTM : '-'}\n          onlineVehiclesSTM={this.state.vehiclesSTM ? this.state.vehiclesSTM.features.length : 0}\n          plannedVehiclesSTM={this.state.plannedTripsSTM ? this.state.plannedTripsSTM.length : 0}\n          routesSTM={this.state.routesSTM ? this.state.routesSTM.length : 0}\n          lastRefreshSTL={this.state.timestampSTL ? this.state.timestampSTL : '-'}\n          onlineVehiclesSTL={this.state.vehiclesSTL ? this.state.vehiclesSTL.features.length : 0}\n          plannedVehiclesSTL={this.state.plannedTripsSTL ? this.state.plannedTripsSTL.length : 0}\n          routesSTL={this.state.routesSTL ? this.state.routesSTL.length : 0}\n          lastRefreshRTL={this.state.timestampRTL ? this.state.timestampRTL : '-'}\n          onlineVehiclesRTL={this.state.vehiclesRTL ? this.state.vehiclesRTL.features.length : 0}\n          plannedVehiclesRTL={this.state.plannedTripsRTL ? this.state.plannedTripsRTL.length : 0}\n          routesRTL={this.state.routesRTL ? this.state.routesRTL.length : 0}\n        />\n        <MapGL\n          {...viewport}\n          ref={(reactMap) => this.reactMap = reactMap}\n          width=\"100%\"\n          height=\"85vh\"\n          mapStyle=\"mapbox://styles/wdoucetk/cjun8whio1ha21fmzxt8knp7k\"\n          onViewportChange={this._onViewportChange}\n          mapboxApiAccessToken={process.env.REACT_APP_MAPBOX_KEY}\n          onHover={this._onHover}\n          onClick={this._onClick}\n        >\n          {this._renderTooltip()}\n        </MapGL>\n      </div>\n    </React.Fragment >\n  }\n}\n\nexport default Livemap;\n\n//mapbox://styles/wdoucetk/cjun8whio1ha21fmzxt8knp7k light\n//mapbox://styles/wdoucetk/cjuc6i3960ggz1flfzzn3upav navigation","import React, { Component } from 'react';\n\nimport {\n  getNewData, closeSocket,\n} from '../API.js'\n\nconst moment = require('moment');\n\nclass Livetrips extends Component {\n\n  state = {\n    subscribed: 0,\n    selectSTM: 0,\n    selectSTL: 0,\n    selectRTL: 0\n  };\n\n  componentDidMount = async () => {\n\n    const getData = this.state.subscribed === 0 ?\n      getNewData((err, positions) => {\n\n\n        // Séparation des donnnées par réseau\n\n        const vehSTM = positions ? positions[0].filter((e) => {\n          return e.reseau === 'STM'\n        }) : ''\n\n        const vehSTL = positions ? positions[0].filter((e) => {\n          return e.reseau === 'STL'\n        }) : ''\n\n        const vehRTL = positions ? positions[0].filter((e) => {\n          return e.reseau === 'RTL'\n        }) : ''\n\n        // Ajout d'une propriété \"online\" aux voyages planifiés\n        // Permet d'identifier les voyages en ligne dans le tableau\n\n        const checkOnlineRTL = positions[1].forEach((e) => {\n          if (vehRTL[0].data.features.filter((f) => {\n            return f.properties.trip_id === e.tripmin\n          }).length > 0) {\n            e.online = 1\n          } else {\n            e.online = 0\n          }\n        })\n\n        // Pour les données de la STL, il n'y a pas de trip_id dans\n        // les appels next_bus - voir si le match peut se faire avec\n        // la ligne et l'heure...\n\n        const checkOnlineSTM = positions[3].forEach((e) => {\n          if (vehSTM[0].data.features.filter((f) => {\n            return f.properties.trip_id === e.tripmin\n          }).length > 0) {\n            e.online = 1\n          } else {\n            e.online = 0\n          }\n        })\n\n        this.setState({\n          vehiclesSTM: positions ? vehSTM[0].data : '',\n          vehiclesSTL: positions ? vehSTL[0].data : '',\n          vehiclesRTL: positions ? vehRTL[0].data : '',\n          timestampSTM: positions ? vehSTM[0].time : '',\n          timestampSTL: positions ? vehSTL[0].time : '',\n          timestampRTL: positions ? vehSTL[0].time : '',\n          subscribed: 1,\n          plannedTripsRTL: positions ? positions[1] : '',\n          plannedTripsSTL: positions ? positions[2] : '',\n          plannedTripsSTM: positions ? positions[3] : ''\n        })\n\n      })\n      : '';\n\n\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(this.state)\n\n  }\n\n\n  handleClickSTM = async (e) => {\n    this.setState({\n      selectSTM: 1,\n      selectSTL: 0,\n      selectRTL: 0\n    })\n  }\n\n  handleClickRTL = async (e) => {\n    this.setState({\n      selectSTM: 0,\n      selectSTL: 0,\n      selectRTL: 1\n    })\n  }\n\n\n  render() {\n    return (\n      this.state.plannedTripsRTL ?\n        <div className=\"container\">\n          <div className=\"row\">\n            <button\n              id=\"agency-card\"\n              type=\"button\" className=\"col btn btn-outline-info\"\n              style={this.state.selectSTM === 1 ? { backgroundColor: \"#38B2A3\", color: \"#FFFFFF\" } : { backgroundColor: \"#E9F1F3\", color: \"#000000\" }}\n              onClick={(e) => this.handleClickSTM(e)}>\n              STM\n            </button>\n            <button type=\"button\" className=\"col btn btn-outline-secondary\" disabled>\n              STL\n            </button>\n            <button\n              type=\"button\" className=\"col btn btn-outline-info\"\n              style={this.state.selectRTL === 1 ? { backgroundColor: \"#38B2A3\", color: \"#FFFFFF\" } : { backgroundColor: \"#E9F1F3\", color: \"#000000\" }}\n              onClick={(e) => this.handleClickRTL(e)}\n            >\n              RTL\n            </button>\n          </div>\n          <div className=\"row\">\n            <table id=\"tableOnline\" className=\"table\">\n              <thead>\n                <tr>\n                  <th>\n                    Ligne\n                  </th>\n                  <th>\n                    Heure de départ\n                  </th>\n                  <th>\n                    Heure de fin\n                    </th>\n                  <th>\n                    Trip ID\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {this.state.selectRTL == 1 ? this.state.plannedTripsRTL.sort((a, b) => (a.timemin > b.timemin) ? 1 : -1)\n                  .map((e) => (\n                    <tr key={e.tripmin}>\n                      <td>{e.route_id}</td>\n                      <td>{moment(\"2019-05-10\").startOf('day').seconds(e.timemin).format('H:mm:ss')}</td>\n                      <td>{moment(\"2019-05-10\").startOf('day').seconds(e.timemax).format('H:mm:ss')}</td>\n                      <td style={{ backgroundColor: e.online === 1 ? \"#ABFFAB\" : \"#FFABAB\" }}>{e.tripmin}</td>\n                    </tr>\n                  )) :\n                  this.state.selectSTM == 1 ? this.state.plannedTripsSTM.sort((a, b) => (a.timemin > b.timemin) ? 1 : -1)\n                    .map((e) => (\n                      <tr key={e.tripmin}>\n                        <td>{e.route_id}</td>\n                        <td>{moment(\"2019-05-10\").startOf('day').seconds(e.timemin).format('H:mm:ss')}</td>\n                        <td>{moment(\"2019-05-10\").startOf('day').seconds(e.timemax).format('H:mm:ss')}</td>\n                        <td style={{ backgroundColor: e.online === 1 ? \"#ABFFAB\" : \"#FFABAB\" }}>{e.tripmin}</td>\n                      </tr>\n                    )) :\n                    <tr>\n                      <td colspan=\"4\" style={{ textAlign: \"center\" }}> Sélectionner une agence</td>\n                    </tr>}\n              </tbody>\n            </table>\n          </div>\n        </div >\n        : 'Chargement...'\n    );\n  }\n}\n\nexport default Livetrips;","import React, { Component } from 'react';\nimport { getHistory } from '../API';\nimport {\n  ResponsiveContainer,\n  ScatterChart,\n  Scatter,\n  XAxis,\n  YAxis,\n  ZAxis,\n  Tooltip,\n  Legend\n} from 'recharts';\n\nconst moment = require('moment');\n\nclass Historique extends Component {\n\n  state = {\n    history: null\n  };\n\n  componentDidMount = async () => {\n\n    const allVehicles = await getHistory()\n\n    const parseAll = [];\n\n    // Modifier le format de hh:mm:ss à unix milliseconds\n    // C'est le format privilégié par Recharts pour les unités de temps\n\n    const parsing = allVehicles ?\n      allVehicles.forEach((e) => {\n        parseAll.push({\n          reseau: e.reseau,\n          time: parseInt(moment(\"2019-04-28 \" + e.timestr).format('x')),\n          vehlen: e.vehlen,\n          weekday: e.weekday\n        })\n      }) : ''\n\n    // Séparation des données de semaine, samedi, dimanche\n\n    const week = parseAll.filter((e) => {\n      return parseInt(e.weekday) > 1 && parseInt(e.weekday) < 7\n    })\n\n    const saturday = parseAll.filter((e) => {\n      return parseInt(e.weekday) === 7\n    })\n\n    const sunday = parseAll.filter((e) => {\n      return parseInt(e.weekday) === 1\n    })\n\n    this.setState({\n      week: week,\n      saturday: saturday,\n      sunday: sunday\n    })\n\n    console.log(this.state)\n\n\n\n\n\n  }\n\n\n  render() {\n\n    const CustomTooltip = ({ active, payload }) => {\n      if (active) {\n        return (\n          <div className=\"custom-tooltip\">\n            <p className=\"label\">Réseau : {payload[0].payload.reseau}<br />\n              Heure : {moment(payload[0].payload.time).format('HH:mm:ss')}<br />\n              Véhicules : {payload[0].payload.vehlen}</p>\n          </div>\n        );\n      }\n\n      return null;\n    };\n\n    return this.state.sunday ? (\n      <div className=\"container-fluid\" >\n        <br />\n\n        <div id=\"chartCard\">\n          <h1 style={{ color: '#000000', textAlign: 'center' }}>Semaine</h1>\n          <ResponsiveContainer width=\"100%\" height={350}>\n            <ScatterChart width={730} height={250}\n              margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n              <XAxis\n                type=\"number\"\n                dataKey=\"time\"\n                name='time'\n                domain={[1556420760000, 1556495999000]}\n                tickFormatter={(unixTime) => moment(unixTime).format('HH:mm:ss')}\n                ticks={[\n                  1556424000100,\n                  1556427600000, 1556431200000, 1556434800000, 1556438400000,\n                  1556442000000, 1556445600000, 1556449200000, 1556452800000,\n                  1556456400000, 1556460000000, 1556463600000, 1556467200000,\n                  1556470800000, 1556474400000, 1556478000000, 1556481600000,\n                  1556485200000, 1556488800000, 1556492400000, 1556496000000,\n                  1556499600000, 1556503200000, 1556506800000, 1556510399900\n                ]}\n              />\n              <YAxis dataKey=\"vehlen\" name='véhicules' />\n              <ZAxis dataKey=\"z\" range={[20]} />\n              <Tooltip\n                content={<CustomTooltip />}\n              />\n              <Legend />\n              <Scatter name=\"STM\" data={this.state.week.filter((e) => { return e.reseau === 'STM' })} fill=\"#009DE0\" />\n              <Scatter name=\"STL\" data={this.state.week.filter((e) => { return e.reseau === 'STL' })} fill=\"#82C341\" />\n              <Scatter name=\"RTL\" data={this.state.week.filter((e) => { return e.reseau === 'RTL' })} fill=\"#A93332\" />\n            </ScatterChart>\n          </ResponsiveContainer>\n        </div >\n\n\n        <div id=\"chartCard\">\n          <h1 style={{ color: '#000000', textAlign: 'center' }}>Samedi</h1>\n          <ResponsiveContainer width=\"100%\" height={350}>\n            <ScatterChart width={730} height={250}\n              margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n              <XAxis\n                type=\"number\"\n                dataKey=\"time\"\n                name='time'\n                domain={[1556420760000, 1556495999000]}\n                tickFormatter={(unixTime) => moment(unixTime).format('HH:mm:ss')}\n                ticks={[\n                  1556424000100,\n                  1556427600000, 1556431200000, 1556434800000, 1556438400000,\n                  1556442000000, 1556445600000, 1556449200000, 1556452800000,\n                  1556456400000, 1556460000000, 1556463600000, 1556467200000,\n                  1556470800000, 1556474400000, 1556478000000, 1556481600000,\n                  1556485200000, 1556488800000, 1556492400000, 1556496000000,\n                  1556499600000, 1556503200000, 1556506800000, 1556510399900\n                ]} />\n              <YAxis dataKey=\"vehlen\" name='véhicules' />\n              <ZAxis dataKey=\"z\" range={[20]} />\n              <Tooltip\n                content={<CustomTooltip />}\n              />\n              <Legend />\n              <Scatter name=\"STM\" data={this.state.saturday.filter((e) => { return e.reseau === 'STM' })} fill=\"#009DE0\" />\n              <Scatter name=\"STL\" data={this.state.saturday.filter((e) => { return e.reseau === 'STL' })} fill=\"#82C341\" />\n              <Scatter name=\"RTL\" data={this.state.saturday.filter((e) => { return e.reseau === 'RTL' })} fill=\"#A93332\" />\n            </ScatterChart>\n          </ResponsiveContainer>\n        </div >\n\n        <div id=\"chartCard\">\n          <h1 style={{ color: '#000000', textAlign: 'center' }}>Dimanche</h1>\n          <ResponsiveContainer width=\"100%\" height={350}>\n            <ScatterChart width={500} height={250}\n              margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n              <XAxis\n                type=\"number\"\n                dataKey=\"time\"\n                name='time'\n                domain={[1556420760000, 1556495999000]}\n                tickFormatter={(unixTime) => moment(unixTime).format('HH:mm:ss')}\n                ticks={[\n                  1556424000100,\n                  1556427600000, 1556431200000, 1556434800000, 1556438400000,\n                  1556442000000, 1556445600000, 1556449200000, 1556452800000,\n                  1556456400000, 1556460000000, 1556463600000, 1556467200000,\n                  1556470800000, 1556474400000, 1556478000000, 1556481600000,\n                  1556485200000, 1556488800000, 1556492400000, 1556496000000,\n                  1556499600000, 1556503200000, 1556506800000, 1556510399900\n                ]} />\n              <YAxis dataKey=\"vehlen\" name='véhicules' />\n              <ZAxis dataKey=\"z\" range={[20]} />\n              <Tooltip\n                content={<CustomTooltip />}\n              />\n              <Legend />\n              <Scatter name=\"STM\" data={this.state.sunday.filter((e) => { return e.reseau === 'STM' })} fill=\"#009DE0\" />\n              <Scatter name=\"STL\" data={this.state.sunday.filter((e) => { return e.reseau === 'STL' })} fill=\"#82C341\" />\n              <Scatter name=\"RTL\" data={this.state.sunday.filter((e) => { return e.reseau === 'RTL' })} fill=\"#A93332\" />\n            </ScatterChart>\n          </ResponsiveContainer>\n        </div >\n\n\n        <br />\n      </div>\n    ) : 'Chargement...';\n  }\n}\n\nexport default Historique;\n\n","import React from 'react';\nimport { Switch, Route } from 'react-router-dom';\nimport NotFound from './NotFound';\n\nimport Livemap from '../containers/Livemap';\nimport Livetrips from '../containers/Livetrips';\nimport Historique from '../containers/Historique';\n//import Reseaux from '../containers/Reseaux';\n\nconst Routes = () => (\n  <Switch>\n    <Route exact path=\"/\" component={Livemap} />\n    <Route exact path=\"/historique\" component={Historique} />\n    <Route exact path=\"/livetrips\" component={Livetrips} />\n    {/*<Route exact path=\"/reseaux\" component={Reseaux} />*/}\n    <Route path=\"*\" component={NotFound} />\n  </Switch>\n);\n\nexport default Routes;\n","import React, { Component } from 'react';\nimport Header from './components/Header';\nimport Footer from './components/Footer';\nimport Routes from './components/Routes';\nimport './App.css';\n\nclass App extends Component {\n  render() {\n    return (\n      <React.Fragment>\n        <Header />\n        <main id=\"app\">\n          <Routes />\n        </main>\n        <Footer />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter as Router } from 'react-router-dom';\nimport App from './App';\n\nReactDOM.render(\n  <Router>\n    <App />\n  </Router>, document.getElementById('root'));\n"],"sourceRoot":""}